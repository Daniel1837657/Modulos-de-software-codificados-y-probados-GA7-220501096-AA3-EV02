<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Módulo Producto</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <h1>Módulo Producto</h1>

    <!-- Formulario de Registro -->
    <h2>Registrar Producto</h2>
    <form id="formProducto">
        <label>Nombre:</label><br>
        <input type="text" id="name" required><br>
        <label>Descripción:</label><br>
        <input type="text" id="description"><br>
        <label>Precio:</label><br>
        <input type="number" id="price" step="0.01" min="0" required><br><br>
        <button type="submit">Registrar</button>
    </form>
    <p class="alert" id="mensaje"></p>

    <!-- Tabla de Productos -->
    <h2>Listado de Productos</h2>
    <table border="1" id="tablaProductos">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Precio</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <!-- Productos generados dinámicamente -->
        </tbody>
    </table>

    <script>
        const urlBase = 'http://localhost:8080/api/products';

        // Función para cargar productos en la tabla
        function cargarProductos() {
            fetch(urlBase)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.querySelector('#tablaProductos tbody');
                    tbody.innerHTML = '';
                    data.forEach(p => {
                        const fila = document.createElement('tr');
                        fila.innerHTML = `
                            <td>${p.id}</td>
                            <td>${p.name}</td>
                            <td>${p.description}</td>
                            <td>$${p.price.toFixed(2)}</td>
                            <td>
                                <button onclick="editarProducto(${p.id})">Editar</button>
                                <button onclick="eliminarProducto(${p.id})">Eliminar</button>
                            </td>
                        `;
                        tbody.appendChild(fila);
                    });
                });
        }

        // Función para registrar un producto
        document.getElementById('formProducto').addEventListener('submit', function(e){
            e.preventDefault();
            const producto = {
                name: document.getElementById('name').value,
                description: document.getElementById('description').value,
                price: parseFloat(document.getElementById('price').value)
            };

            fetch(urlBase, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(producto)
            })
            .then(res => {
                if(res.ok){
                    document.getElementById('mensaje').textContent = 'Producto registrado correctamente';
                    this.reset();
                    cargarProductos();
                } else {
                    document.getElementById('mensaje').textContent = 'Error al registrar producto';
                }
            });
        });

        // Función para eliminar producto
        function eliminarProducto(id) {
            if(confirm('¿Desea eliminar este producto?')){
                fetch(`${urlBase}/${id}`, { method: 'DELETE' })
                    .then(res => {
                        if(res.ok) cargarProductos();
                    });
            }
        }

        // Función para editar producto
        function editarProducto(id){
            fetch(`${urlBase}/${id}`)
                .then(res => res.json())
                .then(p => {
                    const nuevoNombre = prompt("Nombre:", p.name);
                    const nuevaDesc = prompt("Descripción:", p.description);
                    const nuevoPrecio = parseFloat(prompt("Precio:", p.price));
                    if(nuevoNombre && !isNaN(nuevoPrecio)){
                        fetch(`${urlBase}/${id}`, {
                            method: 'PUT',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                name: nuevoNombre,
                                description: nuevaDesc,
                                price: nuevoPrecio
                            })
                        })
                        .then(res => {
                            if(res.ok) cargarProductos();
                        });
                    }
                });
        }

        // Cargar productos al inicio
        window.onload = cargarProductos;
    </script>
</body>
</html>
